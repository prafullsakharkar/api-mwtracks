"use strict";(self.webpackChunkmwtracks=self.webpackChunkmwtracks||[]).push([[269],{3713:function(e,t,n){n.r(t),n.d(t,{default:function(){return B}});var s=n(16554),i=n(5531),a=n(47313),r=n(22408),l=n(30242),o=n(9038),u=n(65168),d=n(99720),c=n(31335),p=n(52418),f=n(14629),v=n(38954),h=n(94058),m=(0,o.UY)({steps:u.ZP,episodes:d.ZP,sequences:c.ZP,shots:p.ZP,assets:f.ZP,status:v.ZP,utilSteps:h.ZP}),x=n(22116),j=n(1413),Z=n(29439),g=n(83508),y=n(75908),b=n(32729),C=n(31095),S=n(66149),w=n(4117),I=n(96467),q=n(71263),N=n(47131),A=n(30467),E=n(58467),D=n(9289),k=n(61113),V=n(10546),F=n.n(V),L=(n(49614),n.p+"static/media/sample_create_step.0e353ab0989e0c3f2be1.csv"),P=n.p+"static/media/sample_update_step.105c7bd4beb40a441a3c.csv",U=n(46417),_={status:null};var z=function(e){var t,n,s,i=(0,r.I0)(),l=(0,E.UO)(),o=e.stepDialog,v=e.statuses,m=e.episodeIds,x=e.sequenceIds,V=e.shotIds,z=e.stepIds,O=e.assetIds,K=e.utilSteps,M=(0,a.useState)(null),W=(0,Z.Z)(M,2),B=W[0],T=W[1],G=(0,a.useState)([]),H=(0,Z.Z)(G,2),J=H[0],R=H[1],Y=(0,a.useState)(null),Q=(0,Z.Z)(Y,2),X=Q[0],$=Q[1],ee=(0,a.useState)(null),te=(0,Z.Z)(ee,2),ne=te[0],se=te[1],ie=(0,r.v9)((function(e){return e.core.projects.entities})),ae=null===l||void 0===l||null===(t=l.uid)||void 0===t?void 0:t.split(":")[0].toLowerCase(),re=ie&&(null===(n=ie[ae])||void 0===n?void 0:n.is_episodic),le=(0,g.cI)(_),oe=le.form,ue=(le.handleChange,le.setForm),de=le.setInForm,ce=le.resetForm,pe=K&&Object.values(K).map((function(e){return e.name}))||[],fe=(0,a.useState)([]),ve=(0,Z.Z)(fe,2),he=ve[0];ve[1];var me=(0,a.useCallback)((function(){ce(),"edit"===o.type&&o.data&&ue((0,j.Z)({},o.data)),"new"===o.type&&ue((0,j.Z)((0,j.Z)({},_),o.data)),de("project",ae)}),[o.data,o.type,ue]);function xe(){de("name",null),se(null)}function je(){"edit"===o.type?i((0,u.PY)()):"new"===o.type?i((0,u.Ke)()):"multiple"===o.type?i((0,u.kf)()):"csvCreate"===o.type?i((0,u.sN)()):i((0,u.V3)()),xe(),$(null)}function Ze(e){if(e.preventDefault(),"csvCreate"===o.type&&he.length>0)i((0,u.l3)(he));else if("csvUpdate"===o.type&&he.length>0)i((0,u.a)({multipleStepList:he,project:ae}));else if("multiple"===o.type&&o.data&&o.data.length>0){var t=o.data.map((function(e){var t=F()(_,oe);return t.uid=e,t}));i((0,u.a)({multipleStepList:t,project:ae}))}else if("new"===o.type)i((0,u.l3)(oe));else{var n=F()(o.data,oe);n.id=oe.uid,i((0,u.d)(n))}je()}return(0,a.useEffect)((function(){o.props.open&&me()}),[o.props.open,me]),(0,a.useEffect)((function(){"Asset"===X&&O&&R(O),"Shot"===X&&V&&R(V),"Sequence"===X&&V&&R(x)}),[V,O,x,X]),(0,a.useEffect)((function(){if(["Sequence","Shot"].includes(X)){var e,t={uid:null===l||void 0===l||null===(e=l.uid)||void 0===e?void 0:e.split(":")[0].toLowerCase(),entity:"project"};i(re?(0,d.Jy)(t):(0,c.nH)(t))}}),[X,re]),(0,a.useEffect)((function(){var e={entity:X};X&&i((0,h.jG)(e))}),[X]),(0,a.useEffect)((function(){if(ne){var e={asset_type:ne,uid:ae,entity:"project"};i((0,f.Vh)(e))}}),[ne]),(0,a.useEffect)((function(){var e={uid:oe.episode,entity:"episode"};oe.episode&&i((0,c.nH)(e))}),[oe.episode]),(0,a.useEffect)((function(){var e={uid:oe.sequence,entity:"sequence"};oe.sequence&&i((0,p.Sv)(e))}),[oe.sequence]),(0,U.jsxs)(S.Z,(0,j.Z)((0,j.Z)({classes:{paper:"m-24 rounded-8"}},o.props),{},{onClose:je,fullWidth:!0,maxWidth:o.type.startsWith("csv")?"md":"xs",children:[(0,U.jsx)(y.Z,{position:"static",className:"shadow-md",children:(0,U.jsxs)(D.Z,{className:"flex w-full justify-between",children:[(0,U.jsx)(k.Z,{variant:"subtitle1",color:"inherit",children:"new"===o.type?"New Step":"edit"===o.type?"Edit Step":"multiple"===o.type?"Multiple Steps":"csvCreate"===o.type?"Create Steps from CSV":"Update Steps from CSV"}),(0,U.jsx)(k.Z,{variant:"subtitle1",color:"inherit",children:ae&&ae.toUpperCase()})]})}),(0,U.jsxs)("form",{noValidate:!0,onSubmit:Ze,className:"flex flex-col md:overflow-hidden",children:[(0,U.jsxs)(I.Z,{classes:{root:"p-24"},children:["csvCreate"===o.type&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)("a",{variant:"contained",color:"secondary",href:L,download:"SampleCreateStep.csv",children:"Download Sample CSV"})}),"csvUpdate"===o.type&&(0,U.jsx)(U.Fragment,{children:(0,U.jsx)("a",{variant:"contained",color:"secondary",href:P,download:"SampleUpdateStep.csv",children:"Download Sample CSV"})}),"edit"===o.type&&(0,U.jsx)("div",{className:"flex mb-16 justify-center",children:(0,U.jsx)(k.Z,{variant:"subtitle1",color:"secondary",children:oe.uid})}),"new"===o.type&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{className:"flex flex-row mb-16",children:[(0,U.jsx)("div",{className:"flex-1 mr-5",children:(0,U.jsx)(b.Z,{value:X,onChange:function(e,t){$(t),xe()},disableClearable:!0,id:"entityType",options:["Asset","Shot","Sequence"],renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Entity",required:!0,variant:"outlined"}))}})}),X&&"Asset"===X&&(0,U.jsx)("div",{className:"flex-1",children:(0,U.jsx)(b.Z,{value:ne,onChange:function(e,t){se(t)},disableClearable:!0,id:"assetType",options:["Set","Prop","Character","Vehicle","Fx"],renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Asset Type",required:!0,variant:"outlined"}))}})})]}),X&&"Shot"===X&&(0,U.jsx)(U.Fragment,{children:(0,U.jsxs)("div",{className:"flex flex-1 mb-16",children:[re&&(0,U.jsx)("div",{className:"flex-1 mr-5",children:(0,U.jsx)(b.Z,{value:oe.episode,onChange:function(e,t){de("episode",t)},disableClearable:!0,getOptionLabel:function(e){return e.split(":").slice(-1).join()},id:"episode",options:m,renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Episode",required:!0,variant:"outlined"}))}})}),(0,U.jsx)("div",{className:"flex-1",children:(0,U.jsx)(b.Z,{value:oe.sequence,onChange:function(e,t){de("sequence",t)},disableClearable:!0,getOptionLabel:function(e){return e.split(":").slice(-1).join()},id:"sequence",options:x,renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Sequence",required:!0,variant:"outlined"}))}})})]})}),["new","edit","multiple"].includes(o.type)&&(0,U.jsxs)("div",{className:"flex flex-row mb-16",children:[(0,U.jsx)("div",{className:"mr-5 flex-1",children:(0,U.jsx)(b.Z,{value:B,onChange:function(e,t){de("Asset"===X?"asset":"Sequence"===X?"sequence":"shot",t),T(t)},disableClearable:!0,getOptionLabel:function(e){return e.split(":").slice(-1).join()},id:X,options:J,renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:X,required:!0,variant:"outlined"}))}})}),(0,U.jsx)("div",{className:"flex-1",children:(0,U.jsx)(b.Z,{value:oe.name,onChange:function(e,t){de("name",t)},disableClearable:!0,id:"name",options:pe,renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Name",required:!0,variant:"outlined"}))}})})]})]}),["new","edit","multiple"].includes(o.type)&&(0,U.jsx)("div",{className:"flex mb-16",children:(0,U.jsx)("div",{className:"mr-5 flex-1",children:(0,U.jsx)(b.Z,{value:oe.status&&v[(null===(s=oe.status)||void 0===s?void 0:s.id)||oe.status],onChange:function(e,t){de("status",t.id)},disableClearable:!0,getOptionLabel:function(e){return e.name},id:"status",options:Object.values(v),renderInput:function(e){return(0,U.jsx)(A.Z,(0,j.Z)((0,j.Z)({},e),{},{label:"Status",required:!0,variant:"outlined"}))}})})})]}),(0,U.jsxs)(w.Z,{className:"justify-between pl-16",children:[(0,U.jsx)(C.Z,{variant:"contained",color:"primary",onClick:Ze,type:"submit",disabled:!(o.type.startsWith("csv")?he.length>0:"new"===o.type?z&&B&&oe.name&&!z.includes(B+":"+oe.name):oe.status||oe.priority),children:["edit","multiple","csvUpdate"].includes(o.type)?"Update":"Create"}),(0,U.jsx)(N.Z,{onClick:je,children:(0,U.jsx)(q.Z,{children:"close"})})]})]})]}))},O=n(65503),K=n(89600),M=n(88584);var W=function(e){var t=(0,r.I0)(),n=(0,E.UO)(),s=(0,r.v9)(u.QO),i=(0,r.v9)((function(e){return e.stepApp.steps.isLoading})),l=(0,r.v9)((function(e){return e.stepApp.steps.totalCount})),o=(0,a.useState)(!1),d=(0,Z.Z)(o,2),c=d[0],p=d[1],f=(0,a.useState)(""),v=(0,Z.Z)(f,2),h=v[0],m=v[1],x=(0,a.useState)([]),j=(0,Z.Z)(x,2),g=j[0],y=j[1],b=(0,a.useState)({pageIndex:0,pageSize:25}),S=(0,Z.Z)(b,2),w=S[0],I=S[1];(0,a.useEffect)((function(){!function(){s.length&&p(!0);var e={page_size:w.pageSize,start:w.pageIndex*w.pageSize};e[n.entity]=n.uid,h&&(e.search=h);var i=g.length>0&&g.map((function(e){return e.desc?"-"+e.id:e.id}))||[];i.length>0&&(e.ordering=i.join(",")),t((0,u.It)(e)),p(!1)}()}),[h,w.pageIndex,w.pageSize,g,n]),(0,a.useEffect)((function(){I({pageIndex:0,pageSize:25})}),[h]);var q=a.useMemo((function(){return[{header:"Id",accessorKey:"uid",Cell:function(e){var t=e.row;return(0,U.jsx)(k.Z,{className:"cursor-pointer",onClick:function(e){e.preventDefault(),O.Z.push("/entity/step/"+t.original.uid+"/overview")},children:t.original.uid})}},{header:"Name",accessorKey:"name"},{header:"Bid (in days)",accessorKey:"bid_days"},{header:"Status",accessorKey:"status",size:240,Cell:function(e){var t,n,s=e.cell;return(0,U.jsx)(C.Z,{size:"small",variant:"outlined",sx:{color:null===(t=s.getValue())||void 0===t?void 0:t.color,width:200},children:null===(n=s.getValue())||void 0===n?void 0:n.name})}},{header:"Start Date",accessorKey:"start_date",Cell:function(e){var t=e.cell;return(0,U.jsx)("span",{children:t.getValue()&&(0,K.Z)(new Date(t.getValue()),"dd-MM-y hh:mm:ss")})}},{header:"Retakes",accessorKey:"retakes"},{header:"Created At",accessorKey:"created_at",Cell:function(e){var t=e.cell;return(0,U.jsx)("span",{children:t.getValue()&&(0,K.Z)(new Date(t.getValue()),"dd-MM-y hh:mm:ss")})}}]}),[]);return(0,U.jsx)(M.Z,{columns:q,data:s,onGlobalFilterChange:m,onPaginationChange:I,onSortingChange:y,rowCount:l,state:{globalFilter:h,isLoading:i,pagination:w,showProgressBars:c,sorting:g},openEditDialog:u.E2,openNewDialog:u.nL,removeEntities:u.w7,openMultipleDialog:u.Rz,openCsvCreateDialog:u.rW,openCsvUpdateDialog:u.vf})};var B=(0,i.Z)("stepApp",m)((function(){var e=(0,r.I0)(),t=(0,l.Z)((function(e){return e.breakpoints.down("lg")})),n=(0,r.v9)((function(e){return e.stepApp.steps.stepDialog})),i=(0,r.v9)((function(e){return e.stepApp.steps.totalCount})),o=(0,r.v9)((function(e){return e.stepApp.status.entities})),u=(0,r.v9)((function(e){return e.stepApp.utilSteps.entities})),d=(0,r.v9)((function(e){return e.stepApp.episodes.ids})),c=(0,r.v9)((function(e){return e.stepApp.sequences.ids})),p=(0,r.v9)((function(e){return e.stepApp.shots.ids})),f=(0,r.v9)((function(e){return e.stepApp.steps.ids})),h=(0,r.v9)((function(e){return e.stepApp.assets.ids}));return(0,a.useEffect)((function(){e((0,v.JB)())}),[]),(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(s.Z,{header:(0,U.jsx)(x.Z,{entity:"Steps",totalCount:i}),content:(0,U.jsx)(W,{}),scroll:t?"normal":"content"}),(0,U.jsx)(z,{stepDialog:n,episodeIds:d,sequenceIds:c,shotIds:p,stepIds:f,assetIds:h,utilSteps:u,statuses:o})]})}))}}]);